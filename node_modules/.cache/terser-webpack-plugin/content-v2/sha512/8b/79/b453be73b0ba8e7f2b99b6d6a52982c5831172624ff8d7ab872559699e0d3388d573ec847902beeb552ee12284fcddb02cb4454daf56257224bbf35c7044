{"code":"!function(e){var n={};function r(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=n,r.d=function(e,n,t){r.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},r.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},r.t=function(e,n){if(1&n&&(e=r(e)),8&n)return e;if(4&n&&\"object\"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,\"default\",{enumerable:!0,value:e}),2&n&&\"string\"!=typeof e)for(var o in e)r.d(t,o,function(n){return e[n]}.bind(null,o));return t},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,\"a\",n),n},r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},r.p=\"\",r(r.s=9)}([function(module,exports,__webpack_require__){\"use strict\";eval(\"\\nvar __importStar = (this && this.__importStar) || function (mod) {\\n    if (mod && mod.__esModule) return mod;\\n    var result = {};\\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\\n    result[\\\"default\\\"] = mod;\\n    return result;\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst bcrypt = __importStar(__webpack_require__(6));\\nconst Constants_1 = __webpack_require__(21);\\nconst jwt = __importStar(__webpack_require__(22));\\nexports.genRandomString = () => {\\n    let randomString = '';\\n    const possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\\n    for (let i = 0; i < 10; i++) {\\n        randomString += possible.charAt(Math.floor(Math.random() * possible.length));\\n    }\\n    randomString = Date.now().toString() + randomString;\\n    return randomString;\\n};\\nexports.encrypt = password => {\\n    const salt = bcrypt.genSaltSync(Constants_1.Constants.BCRYPT.SALT_WORK_FACTOR);\\n    const hash = bcrypt.hashSync(password, salt);\\n    return hash;\\n};\\nexports.calcAverage = (list) => {\\n    let sum = list.reduce((s, x) => (s += x), 0);\\n    return sum / list.length;\\n};\\nexports.classValidator = (that, tobe) => {\\n    // 키의 목록이 올바른지 검사\\n    let properKeyList = Object.keys(tobe);\\n    for (let key in that) {\\n        if (!exports.hasValue(key, properKeyList))\\n            return Error(`Invalid Key Field: ${key}`);\\n    }\\n    for (let key in tobe) {\\n        if (that[key]) {\\n            if (tobe[key].constructor.name != that[key].constructor.name) {\\n                console.log('not same!');\\n                if (that[key].constructor.name == 'Object') {\\n                    let err = exports.classValidator(that[key], tobe[key]);\\n                    if (err)\\n                        return err;\\n                    return null;\\n                }\\n                else {\\n                    return new Error(`Invalid type ${key} in ${tobe.constructor.name}. Field name ${key} must be type ${tobe[key].constructor.name}. Current Type: ${that[key].constructor.name}`);\\n                }\\n            }\\n        }\\n        else {\\n        }\\n    }\\n    return null;\\n};\\nexports.hasValue = (item, array) => {\\n    for (let i of array) {\\n        if (item == i)\\n            return true;\\n    }\\n    return false;\\n};\\nexports.removeNullEntity = (obj) => {\\n    for (let key in obj) {\\n        console.log('key::', key);\\n        console.log('type::', typeof obj[key]);\\n        switch (typeof obj[key]) {\\n            case 'string':\\n                if (obj[key].length == 0) {\\n                    delete obj[key];\\n                }\\n                continue;\\n            case 'object':\\n                console.log('object key:', key);\\n                if (Object.keys(obj[key]).length == 0)\\n                    delete obj[key];\\n                continue;\\n            case 'undefined':\\n                delete obj[key];\\n                continue;\\n            default:\\n                continue;\\n        }\\n    }\\n    console.log('result obj', obj);\\n    return obj;\\n};\\nexports.encodeJwt = (data) => {\\n    const expiresIn = 24 * 360000000;\\n    const jwtToken = jwt.sign(data, \\\"10\\\", { expiresIn });\\n    // session save logic;;\\n    return jwtToken;\\n};\\nexports.decodeJwt = token => {\\n    console.log(token);\\n    var decoded = jwt.verify(token, \\\"10\\\");\\n    return decoded;\\n};\\n\\n\\n//# sourceURL=webpack:///./src/server/utils/index.ts?\")},function(module,exports){eval(\"// shim for using process in browser\\nvar process = module.exports = {};\\n\\n// cached from whatever global is present so that test runners that stub it\\n// don't break things.  But we need to wrap it in a try catch in case it is\\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\\n// function because try/catches deoptimize in certain engines.\\n\\nvar cachedSetTimeout;\\nvar cachedClearTimeout;\\n\\nfunction defaultSetTimout() {\\n    throw new Error('setTimeout has not been defined');\\n}\\nfunction defaultClearTimeout () {\\n    throw new Error('clearTimeout has not been defined');\\n}\\n(function () {\\n    try {\\n        if (typeof setTimeout === 'function') {\\n            cachedSetTimeout = setTimeout;\\n        } else {\\n            cachedSetTimeout = defaultSetTimout;\\n        }\\n    } catch (e) {\\n        cachedSetTimeout = defaultSetTimout;\\n    }\\n    try {\\n        if (typeof clearTimeout === 'function') {\\n            cachedClearTimeout = clearTimeout;\\n        } else {\\n            cachedClearTimeout = defaultClearTimeout;\\n        }\\n    } catch (e) {\\n        cachedClearTimeout = defaultClearTimeout;\\n    }\\n} ())\\nfunction runTimeout(fun) {\\n    if (cachedSetTimeout === setTimeout) {\\n        //normal enviroments in sane situations\\n        return setTimeout(fun, 0);\\n    }\\n    // if setTimeout wasn't available but was latter defined\\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\\n        cachedSetTimeout = setTimeout;\\n        return setTimeout(fun, 0);\\n    }\\n    try {\\n        // when when somebody has screwed with setTimeout but no I.E. maddness\\n        return cachedSetTimeout(fun, 0);\\n    } catch(e){\\n        try {\\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\\n            return cachedSetTimeout.call(null, fun, 0);\\n        } catch(e){\\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\\n            return cachedSetTimeout.call(this, fun, 0);\\n        }\\n    }\\n\\n\\n}\\nfunction runClearTimeout(marker) {\\n    if (cachedClearTimeout === clearTimeout) {\\n        //normal enviroments in sane situations\\n        return clearTimeout(marker);\\n    }\\n    // if clearTimeout wasn't available but was latter defined\\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\\n        cachedClearTimeout = clearTimeout;\\n        return clearTimeout(marker);\\n    }\\n    try {\\n        // when when somebody has screwed with setTimeout but no I.E. maddness\\n        return cachedClearTimeout(marker);\\n    } catch (e){\\n        try {\\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\\n            return cachedClearTimeout.call(null, marker);\\n        } catch (e){\\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\\n            return cachedClearTimeout.call(this, marker);\\n        }\\n    }\\n\\n\\n\\n}\\nvar queue = [];\\nvar draining = false;\\nvar currentQueue;\\nvar queueIndex = -1;\\n\\nfunction cleanUpNextTick() {\\n    if (!draining || !currentQueue) {\\n        return;\\n    }\\n    draining = false;\\n    if (currentQueue.length) {\\n        queue = currentQueue.concat(queue);\\n    } else {\\n        queueIndex = -1;\\n    }\\n    if (queue.length) {\\n        drainQueue();\\n    }\\n}\\n\\nfunction drainQueue() {\\n    if (draining) {\\n        return;\\n    }\\n    var timeout = runTimeout(cleanUpNextTick);\\n    draining = true;\\n\\n    var len = queue.length;\\n    while(len) {\\n        currentQueue = queue;\\n        queue = [];\\n        while (++queueIndex < len) {\\n            if (currentQueue) {\\n                currentQueue[queueIndex].run();\\n            }\\n        }\\n        queueIndex = -1;\\n        len = queue.length;\\n    }\\n    currentQueue = null;\\n    draining = false;\\n    runClearTimeout(timeout);\\n}\\n\\nprocess.nextTick = function (fun) {\\n    var args = new Array(arguments.length - 1);\\n    if (arguments.length > 1) {\\n        for (var i = 1; i < arguments.length; i++) {\\n            args[i - 1] = arguments[i];\\n        }\\n    }\\n    queue.push(new Item(fun, args));\\n    if (queue.length === 1 && !draining) {\\n        runTimeout(drainQueue);\\n    }\\n};\\n\\n// v8 likes predictible objects\\nfunction Item(fun, array) {\\n    this.fun = fun;\\n    this.array = array;\\n}\\nItem.prototype.run = function () {\\n    this.fun.apply(null, this.array);\\n};\\nprocess.title = 'browser';\\nprocess.browser = true;\\nprocess.env = {};\\nprocess.argv = [];\\nprocess.version = ''; // empty string to avoid regexp issues\\nprocess.versions = {};\\n\\nfunction noop() {}\\n\\nprocess.on = noop;\\nprocess.addListener = noop;\\nprocess.once = noop;\\nprocess.off = noop;\\nprocess.removeListener = noop;\\nprocess.removeAllListeners = noop;\\nprocess.emit = noop;\\nprocess.prependListener = noop;\\nprocess.prependOnceListener = noop;\\n\\nprocess.listeners = function (name) { return [] }\\n\\nprocess.binding = function (name) {\\n    throw new Error('process.binding is not supported');\\n};\\n\\nprocess.cwd = function () { return '/' };\\nprocess.chdir = function (dir) {\\n    throw new Error('process.chdir is not supported');\\n};\\nprocess.umask = function() { return 0; };\\n\\n\\n//# sourceURL=webpack:///./node_modules/process/browser.js?\")},function(module,exports){eval('module.exports = require(\"express\");\\n\\n//# sourceURL=webpack:///external_%22express%22?')},function(module,exports,__webpack_require__){\"use strict\";eval(\"/* WEBPACK VAR INJECTION */(function(process) {\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\\"throw\\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nvar __importDefault = (this && this.__importDefault) || function (mod) {\\n    return (mod && mod.__esModule) ? mod : { \\\"default\\\": mod };\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst body_parser_1 = __importDefault(__webpack_require__(10));\\nconst passport_1 = __importDefault(__webpack_require__(11));\\nconst compression_1 = __importDefault(__webpack_require__(12));\\nconst mongoose_1 = __importDefault(__webpack_require__(13));\\nconst cors_1 = __importDefault(__webpack_require__(14));\\nconst cookie_parser_1 = __importDefault(__webpack_require__(15));\\nconst errorHandlers_1 = __webpack_require__(16);\\nconst UserRepositoryImpl_1 = __webpack_require__(!(function webpackMissingModule() { var e = new Error(\\\"Cannot find module '@infra/mongodb/UserRepositoryImpl'\\\"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));\\nconst type_graphql_1 = __webpack_require__(4);\\nconst UserResolver_1 = __webpack_require__(17);\\nconst apollo_server_express_1 = __webpack_require__(18);\\nconst user_service_1 = __webpack_require__(19);\\nconst user_api_1 = __webpack_require__(23);\\nconst SEQUELIZE = 'SEQUELIZE';\\nconst MONGODB = 'MONGODB';\\n__webpack_require__(24).register();\\nexports.config = app => {\\n    // post body 설정을 위한 body parser\\n    app.use(body_parser_1.default.urlencoded({ limit: '50mb', extended: false }));\\n    app.use(body_parser_1.default.json({ limit: '50mb' }));\\n    // 쿠키 파서를 세팅한다.\\n    app.use(cookie_parser_1.default());\\n    // app.use(headerSetter);\\n    app.use(compression_1.default());\\n    app.use(passport_1.default.initialize());\\n    // allow cors to sdf.splashpay.net for all routes\\n    const corsOptions = {\\n        // TODO update to https\\n        origin: [\\n            'https://sdf.splashpay.net',\\n            'http://7go.io.s3-website.ap-northeast-2.amazonaws.com',\\n            'https://develop.splashpay.net'\\n        ],\\n        optionSuccessStatus: 200\\n    };\\n    app.use(cors_1.default(corsOptions));\\n    __webpack_require__(8).config();\\n};\\nexports.initDB = (dbType) => __awaiter(this, void 0, void 0, function* () {\\n    switch (dbType) {\\n        case SEQUELIZE: {\\n            // initialize sequelize mysql\\n            var models = __webpack_require__(25);\\n            //sequelize의 싱크 작업을 시작하고 완료되면 설정된 포트를 통해서 통신 가능하도록 한다.\\n            yield models.sequelize.sync();\\n            // services = new Service(models);\\n        }\\n        case MONGODB: {\\n            yield mongoose_1.default.connect(process.env.MONGO_REPLICA_SET);\\n            return mongoose_1.default.connection;\\n        }\\n        default: {\\n            return;\\n        }\\n    }\\n});\\nexports.apolloSetup = () => __awaiter(this, void 0, void 0, function* () {\\n    const schema = yield type_graphql_1.buildSchema({\\n        resolvers: [UserResolver_1.UserResolver]\\n    });\\n    return new apollo_server_express_1.ApolloServer({\\n        schema,\\n        context: ({ req }) => ({\\n            user: req.user\\n        })\\n    });\\n});\\nexports.initComponent = connection => {\\n    // Repositories\\n    const userRepository = new UserRepositoryImpl_1.UserRepositoryImpl();\\n    // services\\n    const userService = new user_service_1.UserService();\\n    // apis\\n    const userApi = new user_api_1.UserApi(userService, userRepository);\\n    return {\\n        userRepository,\\n        userService,\\n        userApi\\n    };\\n};\\nexports.initErrorHandler = app => {\\n    // add error handler\\n    app.use(errorHandlers_1.notFoundErrorHandler);\\n    app.use(errorHandlers_1.domainErrHandler);\\n};\\n\\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(1)))\\n\\n//# sourceURL=webpack:///./src/server/app.ts?\")},function(module,exports){eval('module.exports = require(\"type-graphql\");\\n\\n//# sourceURL=webpack:///external_%22type-graphql%22?')},function(module,exports,__webpack_require__){\"use strict\";eval('\\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\\n};\\nvar __metadata = (this && this.__metadata) || function (k, v) {\\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\\n};\\nvar __importStar = (this && this.__importStar) || function (mod) {\\n    if (mod && mod.__esModule) return mod;\\n    var result = {};\\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\\n    result[\"default\"] = mod;\\n    return result;\\n};\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\nconst typegoose_1 = __webpack_require__(20);\\nconst bcrypt = __importStar(__webpack_require__(6));\\nconst utils_1 = __webpack_require__(0);\\nvar UserType;\\n(function (UserType) {\\n    UserType[\"GENERAL\"] = \"GENERAL\";\\n    UserType[\"ADMIN\"] = \"ADMIN\";\\n})(UserType = exports.UserType || (exports.UserType = {}));\\nclass User extends typegoose_1.Typegoose {\\n    constructor() {\\n        super(...arguments);\\n        this.userType = UserType.GENERAL;\\n        this.createdAt = Date.now();\\n        this.updatedAt = Date.now();\\n    }\\n    comparePassword(password) {\\n        return bcrypt.compareSync(password, this.password);\\n    }\\n    changePassword(password) {\\n        this.password = utils_1.encrypt(password);\\n    }\\n}\\n__decorate([\\n    typegoose_1.prop({ required: true, unique: true }),\\n    __metadata(\"design:type\", String)\\n], User.prototype, \"phone\", void 0);\\n__decorate([\\n    typegoose_1.prop({ required: true }),\\n    __metadata(\"design:type\", String)\\n], User.prototype, \"password\", void 0);\\n__decorate([\\n    typegoose_1.prop({ required: false, unique: true }),\\n    __metadata(\"design:type\", String)\\n], User.prototype, \"email\", void 0);\\n__decorate([\\n    typegoose_1.prop({ required: false, default: \\'\\' }),\\n    __metadata(\"design:type\", String)\\n], User.prototype, \"name\", void 0);\\n__decorate([\\n    typegoose_1.prop({ required: true, default: UserType.GENERAL }),\\n    __metadata(\"design:type\", String)\\n], User.prototype, \"userType\", void 0);\\n__decorate([\\n    typegoose_1.prop({ default: Date.now, required: true }),\\n    __metadata(\"design:type\", Number)\\n], User.prototype, \"createdAt\", void 0);\\n__decorate([\\n    typegoose_1.prop({ default: Date.now, required: true }),\\n    __metadata(\"design:type\", Number)\\n], User.prototype, \"updatedAt\", void 0);\\n__decorate([\\n    typegoose_1.instanceMethod,\\n    __metadata(\"design:type\", Function),\\n    __metadata(\"design:paramtypes\", [Object]),\\n    __metadata(\"design:returntype\", void 0)\\n], User.prototype, \"changePassword\", null);\\nexports.User = User;\\nconst UserModel = new User().getModelForClass(User);\\nexports.UserModel = UserModel;\\nconst UserSchema = UserModel.schema;\\nexports.UserSchema = UserSchema;\\n\\n\\n//# sourceURL=webpack:///./src/server/domain/user/User.ts?')},function(module,exports){eval('module.exports = require(\"bcrypt\");\\n\\n//# sourceURL=webpack:///external_%22bcrypt%22?')},function(module,exports,__webpack_require__){\"use strict\";eval(\"\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nexports.HttpErrMsg = {\\n    BAD_REQUEST: 'BAD_REQUEST',\\n    DB: {\\n        DUPLICATE_KEY: 'DB.DUPLICATE_KEY',\\n        NO_DATA: 'DB.NO_DATA',\\n        BAD_REQUEST: 'DB.BAD_REQUEST',\\n        INVALID_OBJECTID: 'DB.INVALID_OBJECTID'\\n    },\\n    AUTH: {\\n        NO_USER: 'AUTH.NO_USER',\\n        INVALID_PASSWORD: 'AUTH.INVALID_PASSWORD',\\n        NOT_AUTHORIZED: 'NOT_AUTHORIZED'\\n    },\\n    REGISTER: {\\n        EXIST_TEL: 'REGISTER.EXIST_TEL',\\n        EXIST_EMAIL: 'REGISTER.EXIST_EMAIL'\\n    }\\n};\\n\\n\\n//# sourceURL=webpack:///./src/server/utils/HttpErrMsg.ts?\")},function(module,exports){eval('module.exports = require(\"dotenv\");\\n\\n//# sourceURL=webpack:///external_%22dotenv%22?')},function(module,exports,__webpack_require__){\"use strict\";eval(\"/* WEBPACK VAR INJECTION */(function(process) {\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\\"throw\\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nvar __importDefault = (this && this.__importDefault) || function (mod) {\\n    return (mod && mod.__esModule) ? mod : { \\\"default\\\": mod };\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst app_1 = __webpack_require__(3);\\nconst express_1 = __importDefault(__webpack_require__(2));\\nconst router_1 = __webpack_require__(29);\\nconst logger_1 = __webpack_require__(37);\\nconst MONGODB = 'MONGODB';\\nconst PORT = process.env.PORT || '3001';\\nconst start = () => __awaiter(this, void 0, void 0, function* () {\\n    const app = express_1.default();\\n    app_1.config(app);\\n    const connection = yield app_1.initDB(MONGODB);\\n    router_1.initRouter(app, connection);\\n    app_1.initErrorHandler(app);\\n    const apolloServer = yield app_1.apolloSetup();\\n    apolloServer.applyMiddleware({ app });\\n    app.listen(PORT, () => {\\n        logger_1.logger.info('Express server listening on port ' + PORT);\\n    });\\n});\\nstart();\\n\\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(1)))\\n\\n//# sourceURL=webpack:///./src/server/index.ts?\")},function(module,exports){eval('module.exports = require(\"body-parser\");\\n\\n//# sourceURL=webpack:///external_%22body-parser%22?')},function(module,exports){eval('module.exports = require(\"passport\");\\n\\n//# sourceURL=webpack:///external_%22passport%22?')},function(module,exports){eval('module.exports = require(\"compression\");\\n\\n//# sourceURL=webpack:///external_%22compression%22?')},function(module,exports){eval('module.exports = require(\"mongoose\");\\n\\n//# sourceURL=webpack:///external_%22mongoose%22?')},function(module,exports){eval('module.exports = require(\"cors\");\\n\\n//# sourceURL=webpack:///external_%22cors%22?')},function(module,exports){eval('module.exports = require(\"cookie-parser\");\\n\\n//# sourceURL=webpack:///external_%22cookie-parser%22?')},function(module,exports,__webpack_require__){\"use strict\";eval(\"\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nexports.notFoundErrorHandler = (req, res, next) => {\\n    const err = new Error('Not found');\\n    err.status = 404;\\n    next(err);\\n};\\nexports.domainErrHandler = (err, req, res, next) => {\\n    res.status(err.status || 500);\\n    res.send({\\n        error: {\\n            message: err.message\\n        }\\n    });\\n};\\n\\n\\n//# sourceURL=webpack:///./src/server/infra/middleware/errorHandlers.ts?\")},function(module,exports,__webpack_require__){\"use strict\";eval('\\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\\n};\\nvar __metadata = (this && this.__metadata) || function (k, v) {\\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\\n};\\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\\n    return function (target, key) { decorator(target, key, paramIndex); }\\n};\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\nconst type_graphql_1 = __webpack_require__(4);\\nconst UserGQType_1 = __webpack_require__(!(function webpackMissingModule() { var e = new Error(\"Cannot find module \\'@infra/graphQL/types/UserGQType\\'\"); e.code = \\'MODULE_NOT_FOUND\\'; throw e; }()));\\nlet UserResolver = class UserResolver {\\n    constructor(userRepository) {\\n        this.userRepository = userRepository;\\n    }\\n    findById(id) {\\n        return this.userRepository.findById(id);\\n    }\\n};\\n__decorate([\\n    type_graphql_1.Query(),\\n    __param(0, type_graphql_1.Arg(\\'id\\')),\\n    __metadata(\"design:type\", Function),\\n    __metadata(\"design:paramtypes\", [Number]),\\n    __metadata(\"design:returntype\", void 0)\\n], UserResolver.prototype, \"findById\", null);\\nUserResolver = __decorate([\\n    type_graphql_1.Resolver(UserGQType_1.UserGQType),\\n    __metadata(\"design:paramtypes\", [Object])\\n], UserResolver);\\nexports.UserResolver = UserResolver;\\n\\n\\n//# sourceURL=webpack:///./src/server/infra/graphQL/resolvers/UserResolver.ts?')},function(module,exports){eval('module.exports = require(\"apollo-server-express\");\\n\\n//# sourceURL=webpack:///external_%22apollo-server-express%22?')},function(module,exports,__webpack_require__){\"use strict\";eval('\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\nconst User_1 = __webpack_require__(5);\\nclass UserService {\\n    constructor() { }\\n    // Create new User\\n    create(dto) {\\n        return User_1.UserModel.create(dto);\\n    }\\n    findByEmail(email) {\\n        return User_1.UserModel.findOne({ email: email }).exec();\\n    }\\n}\\nexports.UserService = UserService;\\n\\n\\n//# sourceURL=webpack:///./src/server/domain/user/user.service.ts?')},function(module,exports){eval('module.exports = require(\"typegoose\");\\n\\n//# sourceURL=webpack:///external_%22typegoose%22?')},function(module,exports,__webpack_require__){\"use strict\";eval(\"\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nexports.Constants = {\\n    TEST_DATA: {\\n        PHONE: '01000000000',\\n        PASSWORD: 'test1234'\\n    },\\n    BCRYPT: {\\n        SALT_WORK_FACTOR: 10\\n    }\\n};\\n\\n\\n//# sourceURL=webpack:///./src/server/utils/Constants.ts?\")},function(module,exports){eval('module.exports = require(\"jsonwebtoken\");\\n\\n//# sourceURL=webpack:///external_%22jsonwebtoken%22?')},function(module,exports,__webpack_require__){\"use strict\";eval('\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\nconst User_1 = __webpack_require__(5);\\nconst utils_1 = __webpack_require__(0);\\nconst HttpErrMsg_1 = __webpack_require__(7);\\nclass UserApi {\\n    constructor(userService, userRepository) {\\n        this.userService = userService;\\n        this.userRepository = userRepository;\\n    }\\n    register(dto) {\\n        return new Promise((resolve, reject) => __awaiter(this, void 0, void 0, function* () {\\n            let { phone, email, password } = dto;\\n            //   encrypt password\\n            password = utils_1.encrypt(password);\\n            let u1 = yield this.userRepository.findByQuery({ phone });\\n            if (u1.length != 0)\\n                return reject(new Error(HttpErrMsg_1.HttpErrMsg.REGISTER.EXIST_TEL));\\n            let u2 = yield this.userRepository.findByQuery({ email });\\n            if (u2.length != 0)\\n                return reject(new Error(HttpErrMsg_1.HttpErrMsg.REGISTER.EXIST_EMAIL));\\n            let user = new User_1.User();\\n            Object.assign(dto, user);\\n            this.userRepository.save(user).then(user => {\\n                let data = { _id: user._id };\\n                const jwtToken = utils_1.encodeJwt(data);\\n                resolve({ user: data, token: jwtToken });\\n            }, err => {\\n                reject(err);\\n            });\\n        }));\\n    }\\n}\\nexports.UserApi = UserApi;\\n\\n\\n//# sourceURL=webpack:///./src/server/api/user.api.ts?')},function(module,exports){eval('module.exports = require(\"ts-node\");\\n\\n//# sourceURL=webpack:///external_%22ts-node%22?')},function(module,exports,__webpack_require__){eval(\"/* WEBPACK VAR INJECTION */(function(process) {var models = {};\\n\\nvar Sequelize = __webpack_require__(26);\\n\\nvar Alliacne = __webpack_require__(27);\\n\\nvar Question = __webpack_require__(28);\\n\\n__webpack_require__(8).config();\\n\\nconsole.log(process.env.DB_NAME);\\nvar sequelize = new Sequelize(process.env.DB_NAME, // name of the db\\nprocess.env.DB_USER, //\\nprocess.env.DB_PASSWORD, {\\n  host: process.env.DB_URL,\\n  port: process.env.DB_PORT,\\n  dialect: process.env.DB_TYPE,\\n  pool: {\\n    max: 5,\\n    min: 0,\\n    acquire: 30000,\\n    idle: 10000\\n  }\\n}); // define model\\n\\nmodels['alliance'] = Alliacne(sequelize, Sequelize.DataTypes);\\nmodels['question'] = Question(sequelize, Sequelize.DataTypes);\\nmodels.sequelize = sequelize;\\nmodule.exports = models;\\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(1)))\\n\\n//# sourceURL=webpack:///./src/server/infra/sequelizejs/mysql/index.js?\")},function(module,exports){eval('module.exports = require(\"sequelize\");\\n\\n//# sourceURL=webpack:///external_%22sequelize%22?')},function(module,exports){eval('module.exports = function (sequelize, DataTypes) {\\n  var alliance = sequelize.define(\\'alliance\\', {\\n    allianceId: {\\n      type: DataTypes.INTEGER,\\n      primaryKey: true,\\n      autoIncrement: true\\n    },\\n    title: {\\n      type: DataTypes.STRING\\n    },\\n    companyName: {\\n      type: DataTypes.STRING\\n    },\\n    companyAddress: {\\n      type: DataTypes.STRING\\n    },\\n    companyType: {\\n      // GOVERNMENT, PRIVATE, ETC\\n      type: DataTypes.STRING\\n    },\\n    managerName: {\\n      type: DataTypes.STRING\\n    },\\n    managerTel: {\\n      type: DataTypes.STRING\\n    },\\n    managerEmail: {\\n      type: DataTypes.STRING\\n    },\\n    content: {\\n      type: DataTypes.STRING\\n    },\\n    // \"attachedFile\": {\\n    //   \"index\":{\\n    //     \"fileName\":\"fineName\",\\n    //     \"filePath\":\"filePath\"\\n    //   }\\n    // },\\n    attachedFile: {\\n      type: DataTypes.JSON\\n    },\\n    hompageUrl: {\\n      type: DataTypes.STRING\\n    }\\n  }, {\\n    tableName: \\'alliance\\'\\n  });\\n  return alliance;\\n};\\n\\n//# sourceURL=webpack:///./src/server/infra/sequelizejs/mysql/models/alliance.js?')},function(module,exports){eval(\"module.exports = function (sequelize, DataTypes) {\\n  var question = sequelize.define('question', {\\n    questionId: {\\n      type: DataTypes.INTEGER,\\n      primaryKey: true,\\n      autoIncrement: true\\n    },\\n    category: {\\n      // 서비스 장애, 아이디/비밀번호 분실, 서비스 개선 제안, 기타\\n      type: DataTypes.STRING\\n    },\\n    email: {\\n      type: DataTypes.STRING\\n    },\\n    content: {\\n      type: DataTypes.STRING\\n    }\\n  }, {\\n    tableName: 'question'\\n  });\\n  return question;\\n};\\n\\n//# sourceURL=webpack:///./src/server/infra/sequelizejs/mysql/models/question.js?\")},function(module,exports,__webpack_require__){\"use strict\";eval(\"\\nvar __importDefault = (this && this.__importDefault) || function (mod) {\\n    return (mod && mod.__esModule) ? mod : { \\\"default\\\": mod };\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst user_route_1 = __webpack_require__(30);\\nconst swagger_route_1 = __importDefault(__webpack_require__(32));\\nconst express_1 = __importDefault(__webpack_require__(2));\\nconst auth_guard_1 = __importDefault(__webpack_require__(36));\\nconst app_1 = __webpack_require__(3);\\nexports.initRouter = (app, connection) => {\\n    const components = app_1.initComponent(connection);\\n    app.use('/docs', swagger_route_1.default(express_1.default));\\n    const userRoute = new user_route_1.UserRoute(components.userService, components.userApi, components.userRepository);\\n    // routes\\n    app.use(auth_guard_1.default(components.userRepository));\\n    // admin client\\n    app.use('/admin', express_1.default.static('client/admin'));\\n    app.use('/api/v1/users', userRoute.handle());\\n    // redirect false => not redirect when folder directory\\n    app.use(express_1.default.static('client'));\\n};\\n\\n\\n//# sourceURL=webpack:///./src/server/router.ts?\")},function(module,exports,__webpack_require__){\"use strict\";eval(\"\\nvar __importDefault = (this && this.__importDefault) || function (mod) {\\n    return (mod && mod.__esModule) ? mod : { \\\"default\\\": mod };\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst CreateUserDto_1 = __webpack_require__(31);\\nconst utils_1 = __webpack_require__(0);\\nconst express_1 = __importDefault(__webpack_require__(2));\\nclass UserRoute {\\n    constructor(userService, userApi, userRepository) {\\n        this._createUser = (req, res, next) => {\\n            console.log('post users');\\n            const body = req.body;\\n            let dto = new CreateUserDto_1.CreateUserDto();\\n            let err = dto.validateAndApply(body);\\n            if (err)\\n                return next(err);\\n            this.userApi\\n                .register(body)\\n                .then(result => {\\n                res.cookie('jwtToken', result.token);\\n                res.send(result.user);\\n            })\\n                .catch(next);\\n        };\\n        this._getMyInfo = (req, res, next) => {\\n            const { user } = req;\\n            const { token } = req;\\n            const jwtToken = utils_1.encodeJwt({ _id: user._id });\\n            if (token === 'true') {\\n                return res.status(200).send({ user, token: jwtToken });\\n            }\\n            res.cookie('jwtToken', jwtToken);\\n            return res.status(200).send(user);\\n        };\\n        this.router = express_1.default.Router();\\n        this.userService = userService;\\n        this.userApi = userApi;\\n        this.userRepository = userRepository;\\n    }\\n    handle() {\\n        this.router.post('', this._createUser);\\n        this.router.get('/me', this._getMyInfo);\\n        return this.router;\\n    }\\n}\\nexports.UserRoute = UserRoute;\\n\\n\\n//# sourceURL=webpack:///./src/server/interfaces/http/user.route.ts?\")},function(module,exports,__webpack_require__){\"use strict\";eval('\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\nconst utils_1 = __webpack_require__(0);\\nclass CreateUserDto {\\n    validateAndApply(data) {\\n        let err = utils_1.classValidator(data, this);\\n        if (err)\\n            return err;\\n        Object.assign(this, data);\\n        return null;\\n    }\\n}\\nexports.CreateUserDto = CreateUserDto;\\n\\n\\n//# sourceURL=webpack:///./src/server/domain/user/dto/CreateUserDto.ts?')},function(module,exports,__webpack_require__){\"use strict\";eval(\"\\nvar __importDefault = (this && this.__importDefault) || function (mod) {\\n    return (mod && mod.__esModule) ? mod : { \\\"default\\\": mod };\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst path_1 = __importDefault(__webpack_require__(33));\\nfunction default_1(express) {\\n    const router = express.Router();\\n    const swaggerUi = __webpack_require__(34);\\n    const YAML = __webpack_require__(35);\\n    const swaggerDocument = YAML.load(path_1.default.resolve('./src/server/swagger.yaml'));\\n    //   this.app.use('/api-doc', swaggerUi.serve, swaggerUi.setup(swaggerDocument));\\n    console.log('swagger router!');\\n    router.use('/', swaggerUi.serve);\\n    router.get('/', swaggerUi.setup(swaggerDocument));\\n    return router;\\n}\\nexports.default = default_1;\\n\\n\\n//# sourceURL=webpack:///./src/server/interfaces/http/swagger.route.ts?\")},function(module,exports){eval('module.exports = require(\"path\");\\n\\n//# sourceURL=webpack:///external_%22path%22?')},function(module,exports){eval('module.exports = require(\"swagger-ui-express\");\\n\\n//# sourceURL=webpack:///external_%22swagger-ui-express%22?')},function(module,exports){eval('module.exports = require(\"yamljs\");\\n\\n//# sourceURL=webpack:///external_%22yamljs%22?')},function(module,exports,__webpack_require__){\"use strict\";eval(\"\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst HttpErrMsg_1 = __webpack_require__(7);\\nconst utils_1 = __webpack_require__(0);\\nconst extractUserAndTokenFromRequest = (req, userService) => {\\n    return new Promise((resolve, reject) => {\\n        var jwtToken = '';\\n        if (Object.keys(req.cookies).length == 0 && req.cookies.jwtToken) {\\n            reject('No token');\\n        }\\n        if (Object.keys(req.cookies).length != 0) {\\n            jwtToken = req.cookies.jwtToken;\\n        }\\n        if (jwtToken) {\\n            const decoded = utils_1.decodeJwt(jwtToken);\\n            if (decoded) {\\n                userService.findById(decoded.id).then(user => {\\n                    if (!user)\\n                        return reject(new Error(HttpErrMsg_1.HttpErrMsg.AUTH.NO_USER));\\n                    req.user = user;\\n                    req.token = jwtToken;\\n                    console.log('request user:', req.user._id);\\n                    resolve();\\n                }, err => {\\n                    reject(new Error(HttpErrMsg_1.HttpErrMsg.AUTH.NOT_AUTHORIZED));\\n                });\\n            }\\n            else {\\n                reject(new Error(HttpErrMsg_1.HttpErrMsg.AUTH.NOT_AUTHORIZED));\\n            }\\n            req.headers['authorization'] = `Bearer ${jwtToken}`;\\n        }\\n        else {\\n            reject(new Error(HttpErrMsg_1.HttpErrMsg.AUTH.NOT_AUTHORIZED));\\n        }\\n    });\\n};\\nfunction setProtectList() {\\n    return [\\n        {\\n            path: '/payments',\\n            method: ['GET']\\n        },\\n        {\\n            path: '/businesses',\\n            method: ['POST', 'PUT', 'DELETE']\\n        },\\n        {\\n            path: '/users/me',\\n            method: ['GET']\\n        },\\n        {\\n            path: '/users',\\n            method: ['PUT']\\n        },\\n        {\\n            path: '/users/fcmToken',\\n            method: ['PUT']\\n        },\\n        {\\n            path: '/users/temp-password',\\n            method: ['POST']\\n        },\\n        {\\n            path: '/users/push-settings',\\n            method: ['GET']\\n        },\\n        {\\n            path: '/stripe',\\n            method: ['POST']\\n        },\\n        {\\n            path: '/staffs/phone',\\n            method: ['GET']\\n        }\\n    ];\\n}\\nfunction checkProtedList(req, next) {\\n    return new Promise((resolve, reject) => {\\n        const list = setProtectList();\\n        for (let item of list) {\\n            if (req.path.includes(item.path)) {\\n                for (let method of item.method) {\\n                    if (req.method == method) {\\n                        resolve();\\n                    }\\n                }\\n            }\\n        }\\n        reject();\\n    });\\n}\\nfunction default_1(userService) {\\n    return (req, res, next) => {\\n        console.log('middleware!', req.url);\\n        checkProtedList(req, next).then(result => {\\n            extractUserAndTokenFromRequest(req, userService).then(result => {\\n                next();\\n                return;\\n            }, errMsg => new Error(errMsg));\\n        }, err => {\\n            console.log('not protected!');\\n            next();\\n        });\\n    };\\n}\\nexports.default = default_1;\\n\\n\\n//# sourceURL=webpack:///./src/server/infra/guard/auth.guard.ts?\")},function(module,exports,__webpack_require__){\"use strict\";eval(\"\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst winston_1 = __webpack_require__(38);\\nconst loggersCache = {};\\nlet level = 'debug';\\nif (true) {\\n    level = 'info';\\n}\\nconst myFormat = winston_1.format.printf(its => `${its.timestamp} [${its.label}] ${its.level}: ${its.message}`);\\nconst defaultTransports = [\\n    new winston_1.transports.Console(),\\n    new winston_1.transports.File({ filename: 'logs/error.log', level: 'error' })\\n];\\nfunction loggerConf(myLabel = 'DEFAULT logger') {\\n    return {\\n        level,\\n        // colorize: true,\\n        format: winston_1.format.combine(winston_1.format.label({ label: myLabel }), winston_1.format.colorize(), winston_1.format.timestamp(), winston_1.format.splat(), myFormat),\\n        transports: defaultTransports\\n    };\\n}\\nexports.logger = winston_1.createLogger(loggerConf());\\nmodule.exports = {\\n    logger: exports.logger,\\n    getLogger(label) {\\n        if (!label) {\\n            return exports.logger;\\n        }\\n        const logr = loggersCache[label] ||\\n            (loggersCache[label] = winston_1.createLogger(loggerConf(label)));\\n        return logr;\\n    }\\n};\\n\\n\\n//# sourceURL=webpack:///./src/server/utils/logger.ts?\")},function(module,exports){eval('module.exports = require(\"winston\");\\n\\n//# sourceURL=webpack:///external_%22winston%22?')}]);","extractedComments":[]}