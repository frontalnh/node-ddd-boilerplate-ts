{"version":3,"file":"modules.js","sourceRoot":"","sources":["../../../src/integrations/pluggable/modules.ts"],"names":[],"mappings":";;;AAAA,qCAAsE;AAEtE,6BAA+B;AAE/B,IAAI,WAAsC,CAAC;AAE3C,+CAA+C;AAC/C;IAAA;QACE;;WAEG;QACI,SAAI,GAAW,OAAO,CAAC,EAAE,CAAC;IA6BnC,CAAC;IAvBC;;OAEG;IACI,2BAAS,GAAhB;QAAA,iBAUC;QATC,8BAAuB,CAAC,UAAM,KAAK;;gBACjC,IAAI,CAAC,oBAAa,EAAE,CAAC,cAAc,CAAC,OAAO,CAAC,EAAE;oBAC5C,sBAAO,KAAK,EAAC;iBACd;gBACD,2CACK,KAAK,IACR,OAAO,EAAE,IAAI,CAAC,UAAU,EAAE,KAC1B;;aACH,CAAC,CAAC;IACL,CAAC;IAED,kGAAkG;IAC1F,4BAAU,GAAlB;QACE,IAAI,CAAC,WAAW,EAAE;YAChB,yCAAyC;YACzC,WAAW,GAAG,KAAK,EAAE,CAAC;SACvB;QACD,OAAO,WAAW,CAAC;IACrB,CAAC;IA3BD;;OAEG;IACW,UAAE,GAAW,SAAS,CAAC;IAyBvC,cAAC;CAAA,AAjCD,IAiCC;AAjCY,0BAAO","sourcesContent":["import { addGlobalEventProcessor, getCurrentHub } from '@sentry/core';\nimport { Integration } from '@sentry/types';\nimport * as lsmod from 'lsmod';\n\nlet moduleCache: { [key: string]: string };\n\n/** Add node modules / packages to the event */\nexport class Modules implements Integration {\n  /**\n   * @inheritDoc\n   */\n  public name: string = Modules.id;\n  /**\n   * @inheritDoc\n   */\n  public static id: string = 'Modules';\n\n  /**\n   * @inheritDoc\n   */\n  public setupOnce(): void {\n    addGlobalEventProcessor(async event => {\n      if (!getCurrentHub().getIntegration(Modules)) {\n        return event;\n      }\n      return {\n        ...event,\n        modules: this.getModules(),\n      };\n    });\n  }\n\n  /** Fetches the list of modules and the versions loaded by the entry file for your node.js app. */\n  private getModules(): { [key: string]: string } {\n    if (!moduleCache) {\n      // tslint:disable-next-line:no-unsafe-any\n      moduleCache = lsmod();\n    }\n    return moduleCache;\n  }\n}\n"]}